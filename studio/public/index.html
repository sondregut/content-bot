<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carousel Studio</title>
    <link rel="stylesheet" href="/styles.css" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script>
      firebase.initializeApp({
        apiKey: "AIzaSyCJYaaGX94krV32Exuo7Tu-B6n93QOPgo8",
        authDomain: "fabled-emissary-476021-g0.firebaseapp.com",
        projectId: "fabled-emissary-476021-g0",
        storageBucket: "fabled-emissary-476021-g0.firebasestorage.app",
        messagingSenderId: "343836617249",
        appId: "1:343836617249:web:526cfa5f1af63f75bc1160"
      });
    </script>
  </head>
  <body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="login-overlay">
      <div class="login-card">
        <h1>Carousel Studio</h1>
        <p id="login-subtitle">Sign in to continue.</p>
        <form id="login-form">
          <input type="email" id="login-email" placeholder="Email" required />
          <input type="password" id="login-password" placeholder="Password" required />
          <button type="submit" id="login-btn">Sign In</button>
        </form>
        <div class="auth-toggle">
          <span id="auth-toggle-text">Don't have an account?</span>
          <button type="button" class="auth-toggle-btn" id="auth-toggle-btn">Create Account</button>
        </div>
        <div class="login-divider"><span>or</span></div>
        <button type="button" class="google-btn" id="google-login-btn">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59a14.5 14.5 0 0 1 0-9.18l-7.98-6.19a24.01 24.01 0 0 0 0 21.56l7.98-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Sign in with Google
        </button>
        <div class="error-msg" id="login-error"></div>
      </div>
    </div>

    <div class="app" id="app-shell" style="display:none">
      <header class="app-header">
        <div class="header-left">
          <select id="brand-selector" class="app-dropdown"></select>
          <button class="header-btn brand-add-btn" id="create-brand-btn" title="Create Brand">+</button>
          <button class="header-btn brand-edit-btn" id="edit-brand-btn" title="Edit Brand" style="display:none">&#9998;</button>
          <h1>Carousel Studio</h1>
        </div>
        <div class="header-right">
          <button class="tiktok-connect-btn" id="tiktok-connect-btn" title="Connect TikTok">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 00-.79-.05A6.34 6.34 0 003.15 15.2a6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.73a8.19 8.19 0 004.76 1.52v-3.4a4.85 4.85 0 01-1-.16z"/></svg>
            <span id="tiktok-btn-text">Connect TikTok</span>
          </button>
          <select class="app-dropdown" id="image-model-select">
            <option value="gpt-image-1.5">GPT Image 1.5</option>
            <option value="gpt-image-1">GPT Image 1</option>
            <option value="dall-e-3">DALL-E 3</option>
          </select>
          <button class="header-btn" id="settings-btn" title="API Settings">&#9881;</button>
          <button class="sign-out-btn" id="sign-out-btn" title="Sign Out">Sign Out</button>
        </div>
      </header>

      <div class="app-body">
        <aside class="sidebar" id="sidebar">
          <div class="sidebar-header">
            <h2>Content Ideas</h2>
            <span class="idea-count" id="idea-count">0 ideas</span>
          </div>
          <div class="sidebar-list" id="ideas-list">
            <div class="sidebar-loading">Loading ideas...</div>
          </div>
          <div class="sidebar-footer">
            <button type="button" class="sidebar-face-btn" id="sidebar-face-btn">&#128247; Face Studio</button>
          </div>
        </aside>

        <main class="main-area">
          <div class="empty-state" id="empty-state">
            <div class="empty-icon">&#9998;</div>
            <h2>Select a content idea or use freeform</h2>
            <p>Choose an idea from the sidebar, or describe what you want below.</p>

            <!-- Freeform Section -->
            <div class="freeform-section" id="freeform-section">
              <h3>Freeform AI Generation</h3>
              <p class="freeform-hint">Describe your carousel and Claude will generate all slide content for you to review.</p>
              <textarea class="freeform-input" id="freeform-input" rows="3" placeholder="e.g. Create a 6 slide carousel about the benefits of sprint training with our brand colors, highlighting speed improvement stats"></textarea>
              <div class="freeform-controls">
                <div class="form-group" style="width:100px">
                  <label class="label">Slides</label>
                  <input type="number" id="freeform-slide-count" min="1" max="20" value="7" />
                </div>
                <button type="button" class="btn primary" id="freeform-generate-btn">Generate Content with AI</button>
              </div>
              <div class="freeform-status" id="freeform-status"></div>
            </div>

            <!-- Face Personalization CTA -->
            <div class="personalize-cta" id="personalize-cta">
              <div class="personalize-cta-icon">&#128247;</div>
              <h3>Personalize with Your Face</h3>
              <p>Upload face photos, pick a scenario, and generate AI images of yourself as an athlete.</p>
              <button type="button" class="btn primary" id="open-personalize-btn">Open Face Studio</button>
            </div>
          </div>

          <!-- Full-Page Personalization View -->
          <div class="personalize-view" id="personalize-view" style="display:none">
            <div class="personalize-header">
              <button type="button" class="btn small" id="personalize-back-btn">&larr; Back</button>
              <h2>Personalize with Your Face</h2>
            </div>

            <div class="personalize-layout">
              <!-- Left column: Photos + Scenario + Generate -->
              <div class="personalize-controls-col">
                <label class="label">Your Photos <span class="face-photo-count" id="face-photo-count">0 / 5</span></label>
                <p class="freeform-hint" style="margin:0 0 8px">Multiple angles give better face consistency.</p>
                <div class="face-photos-grid" id="face-photos-grid">
                  <input type="file" id="face-image-input" accept="image/*" multiple style="display:none" />
                  <button type="button" class="face-add-btn" id="face-add-btn" title="Add photo">+</button>
                </div>

                <label class="label" style="margin-top:16px">Choose a Scenario</label>
                <div class="scenario-grid" id="scenario-grid"></div>

                <div class="form-row" style="margin-top:12px">
                  <div class="form-group">
                    <label class="label">Sport</label>
                    <input type="text" id="personalize-sport" placeholder="e.g. basketball, soccer, track..." />
                  </div>
                  <div class="form-group">
                    <label class="label">Or write custom scenario</label>
                    <input type="text" id="personalize-custom" placeholder="e.g. celebrating a championship win..." />
                  </div>
                </div>

                <div class="form-row" style="margin-top:8px">
                  <div class="form-group">
                    <label class="label">Model</label>
                    <select id="personalize-model">
                      <option value="flux">Flux Kontext Pro (best faces)</option>
                      <option value="gpt">GPT Image 1.5 (fallback)</option>
                    </select>
                  </div>
                  <div class="form-group" style="max-width:100px">
                    <label class="label">Count</label>
                    <input type="number" id="personalize-count" min="1" max="10" value="1" />
                  </div>
                </div>

                <button type="button" class="btn primary" id="personalize-generate-btn">Generate Personalized Image</button>
                <div class="freeform-status" id="personalize-status"></div>
              </div>

              <!-- Right column: Results -->
              <div class="personalize-results-col" id="personalize-results">
                <label class="label">Generated Results</label>
                <div class="personalize-results-grid" id="personalize-results-grid"></div>
              </div>
            </div>
          </div>

          <div class="editor-area" id="editor-area" style="display:none">
            <div class="idea-header" id="idea-header">
              <span class="idea-badge" id="idea-badge">1.1</span>
              <h2 id="idea-title">Idea Title</h2>
            </div>

            <div class="slide-tabs" id="slide-tabs"></div>

            <!-- Slide Preview (HTML mockup) -->
            <div class="editor-columns">
            <div class="editor-left-col">

            <div class="slide-preview-panel" id="slide-preview-panel">
              <div class="preview-mockup" id="preview-mockup">
                <div class="mockup-text-group" id="mockup-text-group">
                  <div class="mockup-micro" id="mockup-micro">BRAND</div>
                  <div class="mockup-headline" id="mockup-headline">Headline</div>
                  <div class="mockup-body" id="mockup-body">Body text</div>
                </div>
                <div class="mockup-text-reset" id="mockup-text-reset" style="display:none" title="Reset text position">Reset position</div>
                <div class="mockup-photo-placeholder" id="mockup-photo-placeholder" style="display:none">
                  <span>Photo will be generated here</span>
                </div>
                <div class="mockup-icon" id="mockup-icon">
                  <img id="mockup-icon-img" src="" alt="" />
                </div>
              </div>
            </div>

            <form id="slide-form" class="slide-form">
              <div class="form-row">
                <div class="form-group">
                  <label class="label">Slide Type</label>
                  <select name="slideType" id="slideType">
                    <option value="photo">Photo-led</option>
                    <option value="text">Text-only</option>
                    <option value="mockup">Mockup (Sharp)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="label">Label</label>
                  <input name="slideLabel" id="slideLabel" type="text" placeholder="Hook, Define, CTA..." />
                </div>
              </div>

              <button type="button" class="bg-text-shortcut-btn" id="bg-text-shortcut-btn">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="15" x2="21" y2="15"/><polyline points="8 9 12 5 16 9"/></svg>
                Background + Text (no AI)
              </button>

              <div class="form-section" id="photo-fields" style="display:none">
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Sport</label>
                    <input name="sport" type="text" placeholder="track, soccer..." />
                  </div>
                  <div class="form-group">
                    <label class="label">Setting</label>
                    <input name="setting" type="text" placeholder="stadium, gym..." />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Action / Moment</label>
                    <input name="action" type="text" placeholder="kneeling, eyes closed..." />
                  </div>
                  <div class="form-group">
                    <label class="label">Mood</label>
                    <input name="mood" type="text" placeholder="calm intensity..." />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Overlay Style</label>
                    <select name="overlayStyle">
                      <option value="dark gradient">Dark gradient</option>
                      <option value="frosted glass card">Frosted glass</option>
                      <option value="solid dark bar">Solid dark bar</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="label">Overlay Placement</label>
                    <select name="overlayPlacement">
                      <option value="bottom third">Bottom third</option>
                      <option value="left side">Left side</option>
                      <option value="lower-left">Lower-left</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-section" id="text-fields" style="display:none">
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Background</label>
                    <input name="backgroundStyle" type="text" value="dark premium navy/near-black with very subtle grain" />
                  </div>
                  <div class="form-group">
                    <label class="label">Layout</label>
                    <select name="layoutTemplate">
                      <option value="Layout A - Classic Left Lane">Layout A</option>
                      <option value="Layout B - High Hook">Layout B</option>
                      <option value="Layout C - Center Weighted">Layout C</option>
                      <option value="Layout D - Bottom Emphasis">Layout D</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-section" id="mockup-fields" style="display:none">
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Layout</label>
                    <select name="mockupLayout" id="mockupLayout">
                      <option value="phone-right">Phone Right</option>
                      <option value="phone-left">Phone Left</option>
                      <option value="text-statement">Text Statement</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="label">Theme</label>
                    <select name="mockupTheme" id="mockupTheme">
                      <option value="dark">Dark</option>
                      <option value="light">Light</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Highlight Style</label>
                    <select name="highlightStyle" id="highlightStyle">
                      <option value="subtle">Subtle</option>
                      <option value="bold">Bold</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="label">Image Usage</label>
                    <select name="imageUsage" id="imageUsage">
                      <option value="phone">Phone Frame</option>
                      <option value="figure">Figure / Icon</option>
                      <option value="background">Full Background</option>
                      <option value="none">No Image</option>
                    </select>
                  </div>
                </div>

                <div id="mockup-image-upload-section">
                  <label class="label">Image</label>
                  <div class="ref-upload-row">
                    <input type="file" id="screenshot-image-input" accept="image/*" style="display:none" />
                    <button type="button" class="btn small" id="screenshot-upload-btn">Upload Image</button>
                    <span class="screenshot-filename" id="screenshot-filename">No image</span>
                    <button type="button" class="btn small danger" id="screenshot-clear-btn" style="display:none">Clear</button>
                  </div>
                  <img id="screenshot-preview" class="ref-preview-img" style="display:none" />
                </div>

                <div id="mockup-phone-options" style="display:none">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="label">Phone Angle</label>
                      <select name="phoneAngle" id="phoneAngle">
                        <option value="0">0&deg;</option>
                        <option value="-5">-5&deg;</option>
                        <option value="-8" selected>-8&deg;</option>
                        <option value="-12">-12&deg;</option>
                        <option value="5">5&deg;</option>
                        <option value="8">8&deg;</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="label">Phone Size</label>
                      <select name="phoneSize" id="phoneSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div id="mockup-figure-options" style="display:none">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="label">Position</label>
                      <select name="figurePosition" id="figurePosition">
                        <option value="top-right">Top Right</option>
                        <option value="center-right" selected>Center Right</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="center-left">Center Left</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="center">Center</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="label">Size</label>
                      <select name="figureSize" id="figureSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="label">Corner Radius</label>
                      <select name="figureBorderRadius" id="figureBorderRadius">
                        <option value="0">None</option>
                        <option value="12">Small</option>
                        <option value="24" selected>Medium</option>
                        <option value="48">Large</option>
                        <option value="999">Circle</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div id="mockup-bg-options" style="display:none">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="label">Overlay Darkness</label>
                      <select name="bgOverlayOpacity" id="bgOverlayOpacity">
                        <option value="0.35">Light (35%)</option>
                        <option value="0.55" selected>Medium (55%)</option>
                        <option value="0.7">Dark (70%)</option>
                        <option value="0.85">Very Dark (85%)</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="screenshot-warning" id="screenshot-warning" style="display:none; color:#b45309; font-size:0.78rem; margin-top:4px;">Upload an image above to use with this mode.</div>
              </div>

              <div class="form-section">
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Micro-label</label>
                    <input name="microLabel" type="text" placeholder="BRAND NAME" />
                  </div>
                  <div class="form-group">
                    <label class="label">Highlight Phrase</label>
                    <input name="highlightPhrase" type="text" placeholder="phrase to highlight" />
                  </div>
                </div>
                <div class="form-group full">
                  <label class="label">Headline</label>
                  <textarea name="headline" rows="2" placeholder="Main headline text"></textarea>
                </div>
                <div class="form-group full">
                  <label class="label">Body</label>
                  <textarea name="body" rows="2" placeholder="Supporting body text"></textarea>
                </div>
              </div>

              <!-- Per-Slide Reference Image -->
              <div class="form-section slide-ref-section">
                <label class="label">Slide Image (overrides global)</label>
                <div class="ref-upload-row">
                  <input type="file" id="slide-ref-input" accept="image/*" style="display:none" />
                  <button type="button" class="btn small" id="slide-ref-btn">Upload</button>
                  <span class="ref-filename" id="slide-ref-filename">No image</span>
                  <button type="button" class="btn small danger" id="slide-ref-clear" style="display:none">Clear</button>
                </div>
                <img id="slide-ref-preview" class="ref-preview-img" style="display:none" />
              </div>

              <!-- Global Background Image Upload -->
              <div class="form-section ref-section">
                <label class="label">Global Background Image (optional)</label>
                <div class="ref-upload-row">
                  <input type="file" id="ref-image-input" accept="image/*" style="display:none" />
                  <button type="button" class="btn small" id="ref-upload-btn">Upload Image</button>
                  <span class="ref-filename" id="ref-filename">No image</span>
                  <button type="button" class="btn small danger" id="ref-clear-btn" style="display:none">Clear</button>
                </div>
                <img id="ref-preview" class="ref-preview-img" style="display:none" />
                <div id="ref-options" style="display:none">
                  <div class="form-row" style="margin-top:8px">
                    <div class="form-group">
                      <label class="label">Usage</label>
                      <select name="referenceUsage" id="referenceUsage">
                        <option value="background image with dark overlay">Background + dark overlay</option>
                        <option value="background inspiration">Background inspiration</option>
                        <option value="style reference">Style reference</option>
                        <option value="composite element">Composite element</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="label">Extra instructions</label>
                      <input name="referenceInstructions" type="text" placeholder="e.g., darken and blur the background..." />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Icon & Watermark Settings -->
              <div class="form-section icon-section">
                <label class="label">App Icon Watermark</label>
                <div class="icon-settings-row">
                  <div class="icon-preview-box" id="icon-preview-box">
                    <img id="icon-preview-img" src="" alt="App Icon" />
                    <button type="button" class="btn small" id="icon-upload-btn">Change Icon</button>
                    <input type="file" id="icon-file-input" accept="image/*" style="display:none" />
                  </div>
                  <div class="icon-controls">
                    <label class="checkbox">
                      <input type="checkbox" name="includeOwl" checked />
                      Show watermark
                    </label>
                    <div class="corner-picker" id="corner-picker">
                      <div class="corner-grid">
                        <button type="button" class="corner-btn" data-pos="top-left" title="Top Left">TL</button>
                        <button type="button" class="corner-btn" data-pos="top-right" title="Top Right">TR</button>
                        <button type="button" class="corner-btn" data-pos="bottom-left" title="Bottom Left">BL</button>
                        <button type="button" class="corner-btn active" data-pos="bottom-right" title="Bottom Right">BR</button>
                      </div>
                    </div>
                    <input type="hidden" name="owlPosition" id="owlPosition" value="bottom-right" />
                  </div>
                </div>
              </div>

              <div class="form-section controls-row">
                <div class="form-row">
                  <div class="form-group">
                    <label class="label">Quality</label>
                    <select name="quality">
                      <option value="high">High</option>
                      <option value="medium">Medium</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="action-buttons">
                <button type="submit" class="btn primary">Generate This Slide</button>
                <button type="button" class="btn accent" id="generate-all-btn">Generate All Slides</button>
              </div>
            </form>

            </div><!-- /.editor-left-col -->

            <div class="editor-right-col">

            <div class="edit-section" id="edit-section" style="display:none">
              <div class="edit-bar">
                <input type="text" id="edit-instructions" placeholder="e.g. make background darker, change text color to gold..." />
                <button type="button" class="btn primary small" id="apply-edit-btn">Apply Edit</button>
              </div>
            </div>

            <div class="preview-section">
              <div class="status" id="status">Ready.</div>
              <div class="preview-frame" id="preview-frame">
                <div class="loading-spinner" id="loading-spinner">
                  <div class="spinner-ring"></div>
                  <div class="spinner-text" id="spinner-text">Generating image...</div>
                </div>
                <img id="preview-image" alt="Generated slide" />
              </div>
              <div class="download-buttons" id="download-buttons" style="display:none">
                <button type="button" class="btn small primary" id="download-single-btn">Download This Slide</button>
              </div>
            </div>

            <div class="gallery-section" id="gallery-section" style="display:none">
              <div class="gallery-header">
                <h3>Generated Slides</h3>
                <div class="gallery-actions">
                  <button type="button" class="btn small accent" id="download-all-btn">Download All as ZIP</button>
                  <button class="btn small tiktok-post-btn" id="tiktok-post-btn" style="display:none">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 00-.79-.05A6.34 6.34 0 003.15 15.2a6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.73a8.19 8.19 0 004.76 1.52v-3.4a4.85 4.85 0 01-1-.16z"/></svg>
                    Post to TikTok
                  </button>
                </div>
              </div>
              <div class="gallery-strip" id="gallery-strip"></div>
            </div>

            <div class="progress-section" id="progress-section" style="display:none">
              <div class="progress-label" id="progress-label">Generating...</div>
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
              </div>
            </div>

            </div><!-- /.editor-right-col -->
            </div><!-- /.editor-columns -->
          </div>
        </main>
      </div>
    </div>

    <!-- Photo Vault -->
    <button class="vault-toggle-btn" id="vault-toggle-btn">
      <span>Vault</span>
      <span class="vault-count" id="vault-count">0</span>
    </button>
    <div class="vault-backdrop" id="vault-backdrop"></div>
    <div class="vault-panel" id="vault-panel">
      <div class="vault-header">
        <h3>Photo Vault</h3>
        <button class="vault-close-btn" id="vault-close-btn">&times;</button>
      </div>
      <div class="vault-grid" id="vault-grid"></div>
    </div>

    <!-- Settings Modal -->
    <!-- Brand Creation / Edit Modal -->
    <div class="modal-overlay" id="brand-modal" style="display:none">
      <div class="modal brand-modal-wide">
        <div class="modal-header">
          <h3 id="brand-modal-title">Create Brand</h3>
          <button class="modal-close" id="brand-modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group full">
            <label class="label">Brand Name *</label>
            <input type="text" id="brand-name" placeholder="e.g. My Startup" required />
          </div>
          <div class="form-group full">
            <label class="label">Website URL</label>
            <input type="text" id="brand-website" placeholder="e.g. myapp.com â€” paste a URL and we'll auto-fill everything" />
          </div>

          <!-- Website Analysis Section -->
          <div id="brand-analysis-section" style="display:none">
            <!-- Brand Preview Card (prominent, shows once data arrives) -->
            <div class="brand-preview-card" id="brand-preview-row" style="display:none">
              <img id="brand-preview-thumb" class="brand-preview-thumb" />
              <div class="brand-preview-info">
                <strong id="brand-preview-name"></strong>
                <p id="brand-preview-desc"></p>
              </div>
            </div>

            <!-- Collapsible Analysis Accordion -->
            <div class="brand-analysis-card" id="brand-analysis-card">
              <div class="analysis-header" id="analysis-header">
                <span class="analysis-header-label">Analyzing Your Brand</span>
                <span class="analysis-header-count" id="analysis-count">0 of 4 completed</span>
                <span class="analysis-chevron" id="analysis-chevron">&#9660;</span>
              </div>
              <div class="brand-analysis-steps" id="brand-analysis-steps">
                <div class="analysis-step" data-step="fetch">
                  <span class="step-icon"></span>
                  <span class="step-text">Finding your website...</span>
                </div>
                <div class="analysis-step" data-step="analyze">
                  <span class="step-icon"></span>
                  <span class="step-text">Analyzing brand identity...</span>
                </div>
                <div class="analysis-step" data-step="images">
                  <span class="step-icon"></span>
                  <span class="step-text">Extracting images & colors...</span>
                </div>
                <div class="analysis-step" data-step="generate">
                  <span class="step-icon"></span>
                  <span class="step-text">Generating brand profile...</span>
                </div>
              </div>
              <!-- Status line -->
              <div class="analysis-status-line" id="analysis-status-line" style="display:none">
                <span id="analysis-status-text"></span>
              </div>
            </div>

            <div id="brand-images-section" style="display:none">
              <label class="label">Website Images <span id="brand-images-count"></span></label>
              <div class="brand-images-grid" id="brand-images-grid"></div>
            </div>
          </div>

          <div class="form-group full" id="brand-description-group">
            <label class="label">Short Description</label>
            <textarea id="brand-description" rows="2" placeholder="Auto-filled from your website, or type manually"></textarea>
          </div>

          <div class="brand-ai-row" id="brand-ai-row">
            <button type="button" class="btn secondary" id="brand-ai-setup-btn">Regenerate with AI</button>
            <span class="brand-ai-status" id="brand-ai-status">Paste a URL to auto-setup</span>
          </div>

          <div class="brand-colors-section">
            <label class="label">Brand Colors</label>
            <div class="brand-color-row">
              <div class="brand-color-picker">
                <label>Primary</label>
                <input type="color" id="brand-color-primary" value="#1A1A2E" />
                <span class="color-hex" id="brand-color-primary-hex">#1A1A2E</span>
              </div>
              <div class="brand-color-picker">
                <label>Accent</label>
                <input type="color" id="brand-color-accent" value="#E94560" />
                <span class="color-hex" id="brand-color-accent-hex">#E94560</span>
              </div>
              <div class="brand-color-picker">
                <label>Text</label>
                <input type="color" id="brand-color-white" value="#FFFFFF" />
                <span class="color-hex" id="brand-color-white-hex">#FFFFFF</span>
              </div>
              <div class="brand-color-picker">
                <label>Secondary</label>
                <input type="color" id="brand-color-secondary" value="#16213E" />
                <span class="color-hex" id="brand-color-secondary-hex">#16213E</span>
              </div>
              <div class="brand-color-picker">
                <label>CTA</label>
                <input type="color" id="brand-color-cta" value="#0F3460" />
                <span class="color-hex" id="brand-color-cta-hex">#0F3460</span>
              </div>
            </div>
          </div>

          <details class="brand-advanced">
            <summary>Advanced Settings</summary>
            <div class="form-group full">
              <label class="label">System Prompt (AI brand voice)</label>
              <textarea id="brand-system-prompt" rows="5" placeholder="AI-generated brand brief will appear here..."></textarea>
            </div>
            <div class="form-group full">
              <label class="label">Default Micro-Label</label>
              <input type="text" id="brand-micro-label" placeholder="e.g. MY BRAND" />
            </div>
            <div class="form-group full">
              <label class="label">Watermark Text</label>
              <input type="text" id="brand-watermark" placeholder="e.g. mybrand.com" />
            </div>
            <div class="form-group full">
              <label class="label">Default Background Description</label>
              <input type="text" id="brand-bg-desc" placeholder="e.g. dark navy with subtle grain" />
            </div>
          </details>

          <div class="brand-modal-status" id="brand-modal-status"></div>
        </div>
        <div class="modal-footer">
          <button class="btn" id="brand-delete-btn" style="display:none;color:#ef4444;margin-right:auto">Delete</button>
          <button class="btn" id="brand-modal-cancel">Cancel</button>
          <button class="btn primary" id="brand-save-btn">Save Brand</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="settings-modal" style="display:none">
      <div class="modal">
        <div class="modal-header">
          <h3>API Settings</h3>
          <button class="modal-close" id="settings-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group full">
            <label class="label">OpenAI API Key (image generation)</label>
            <input type="password" id="settings-openai-key" placeholder="sk-..." />
            <span class="field-hint">Used for gpt-image-1.5 slide generation</span>
          </div>
          <div class="form-group full">
            <label class="label">Anthropic API Key (text/prompt refinement)</label>
            <input type="password" id="settings-anthropic-key" placeholder="sk-ant-..." />
            <span class="field-hint">Used for Claude prompt refinement and freeform content generation</span>
          </div>
          <div class="form-group full">
            <label class="label">Fal.ai API Key (face personalization)</label>
            <input type="password" id="settings-fal-key" placeholder="fal-..." />
            <span class="field-hint">Used for Flux Kontext Pro face-consistent image generation. Get one at <a href="https://fal.ai/dashboard/keys" target="_blank" style="color:var(--cyan)">fal.ai/dashboard/keys</a></span>
          </div>
          <div class="settings-status" id="settings-status"></div>
        </div>
        <div class="modal-footer">
          <button class="btn primary" id="settings-save-btn">Save Keys</button>
        </div>
      </div>
    </div>

    <!-- TikTok Post Modal -->
    <div class="tiktok-modal-overlay" id="tiktok-modal" style="display:none">
      <div class="tiktok-modal">
        <div class="tiktok-modal-header">
          <h2>Post to TikTok</h2>
          <button class="tiktok-modal-close" id="tiktok-modal-close">&times;</button>
        </div>
        <div class="tiktok-modal-body">
          <div class="tiktok-slides-preview" id="tiktok-slides-preview"></div>

          <div class="tiktok-field">
            <label>Caption / Description</label>
            <textarea id="tiktok-caption" rows="3" placeholder="Write a caption for your post..." maxlength="2200"></textarea>
            <span class="tiktok-char-count"><span id="tiktok-caption-count">0</span>/2200</span>
          </div>

          <div class="tiktok-field">
            <label>Privacy Level</label>
            <select id="tiktok-privacy">
              <option value="SELF_ONLY">Private (only me)</option>
              <option value="MUTUAL_FOLLOW_FRIENDS">Friends</option>
              <option value="FOLLOWER_OF_CREATOR">Followers</option>
              <option value="PUBLIC_TO_EVERYONE">Public</option>
            </select>
            <p class="tiktok-field-note" id="tiktok-privacy-note">Note: Until your TikTok app is audited, all posts will be set to Private regardless of selection.</p>
          </div>

          <div class="tiktok-field tiktok-toggle-field">
            <label class="tiktok-toggle">
              <input type="checkbox" id="tiktok-auto-music" checked />
              <span class="tiktok-toggle-label">Add recommended music</span>
            </label>
            <p class="tiktok-field-note">TikTok will auto-pick a song. You can change it later in the TikTok app.</p>
          </div>

          <div class="tiktok-field tiktok-toggle-field">
            <label class="tiktok-toggle">
              <input type="checkbox" id="tiktok-disable-comment" />
              <span class="tiktok-toggle-label">Disable comments</span>
            </label>
          </div>

          <div class="tiktok-disclosure-section">
            <p class="tiktok-section-label">Content disclosure (required by TikTok if applicable)</p>
            <label class="tiktok-toggle">
              <input type="checkbox" id="tiktok-brand-content" />
              <span class="tiktok-toggle-label">Paid partnership / branded content</span>
            </label>
            <label class="tiktok-toggle">
              <input type="checkbox" id="tiktok-brand-organic" />
              <span class="tiktok-toggle-label">Brand organic (promoting your own brand)</span>
            </label>
          </div>

          <div class="tiktok-post-status" id="tiktok-post-status"></div>
        </div>
        <div class="tiktok-modal-footer">
          <button class="btn" id="tiktok-cancel-btn">Cancel</button>
          <button class="btn primary tiktok-submit-btn" id="tiktok-submit-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 00-.79-.05A6.34 6.34 0 003.15 15.2a6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.73a8.19 8.19 0 004.76 1.52v-3.4a4.85 4.85 0 01-1-.16z"/></svg>
            Post to TikTok
          </button>
        </div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
